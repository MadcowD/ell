<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="../" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Tool Usage | ell  documentation</title>
<meta content="Tool Usage | ell  documentation" property="og:title"/>
<meta content="Tool Usage | ell  documentation" name="twitter:title"/>
<link href="../_static/pygments.css?v=5cc6ec80" rel="stylesheet" type="text/css"/>
<link href="../_static/theme.css?v=ecdfb4fc" rel="stylesheet" type="text/css"/>
<link href="../_static/autodoc_pydantic.css" rel="stylesheet" type="text/css"/>
<link href="../_static/favicon.ico" rel="icon"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="structured_outputs.html" rel="next" title="Structured Outputs"/>
<link href="ell_complex.html" rel="prev" title="@ell.complex"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-220ZB10X27"></script>
<script>
  if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-220ZB10X27');
  }
</script>
<style>
    .rounded-image {
        border-radius: 10px;
        overflow: hidden;
    }

</style>
<script>
function invertImage(dark) {
    var images = document.querySelectorAll('.invertible-image img');
    var htmlElement = document.documentElement;
    images.forEach(function(image) {
        if (!dark) {
            image.style.filter = 'invert(100%) hue-rotate(160deg)';
        } else {
            image.style.filter = 'none';
        }
    });
}



// Run when the 'dark' class is added or removed from the <html> element
const htmlElement = document.documentElement;

// Use MutationObserver to detect changes in the class attribute
const observer = new MutationObserver((mutations) => {
console.log(document.documentElement.classList)
    mutations.forEach((mutation) => {
            invertImage(document.documentElement.classList.contains('dark'));

    });
});

observer.observe(htmlElement, { attributes: true, attributeFilter: ['class'] });
</script>

<meta content="https://docs.ell.so/" property="og:url"/>
<meta content="ell is a lightweight prompt engineering library treating prompts as functions. It provides tools for versioning, monitoring, and visualization of language model programs." property="og:description"/>
<meta content="https://docs.ell.so/_static/og2.png" property="og:image"/>

<meta content="summary_large_image" property="twitter:card"/>
<meta content="ell is a lightweight prompt engineering library treating prompts as functions. It provides tools for versioning, monitoring, and visualization of language model programs." property="twitter:description"/>

<meta content="ell is a lightweight prompt engineering library treating prompts as functions. It provides tools for versioning, monitoring, and visualization of language model programs." name="description"/>
<meta content="ell, language model programming, prompt engineering, LLM, AI, machine learning, GPT" name="keywords"/>
<meta content="William Guss" name="author"/>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<style>
:root {
  --color-1: 0 100% 63%;
  --color-2: 270 100% 63%;
  --color-3: 210 100% 63%;
  --color-4: 195 100% 63%;
  --color-5: 90 100% 63%;
}

@keyframes rainbow {
    0% { background-position: 0%; }
    100% { background-position: 200%; }
}

.github-star-btn {
    height: 2.2rem;
    padding: 0.5rem 1rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.75rem;
    font-weight: 500;
    font-size: 14px;
    cursor: pointer;
    border: 0;
    position: relative;
    background-size: 200%;
    background-clip: padding-box, border-box, border-box;
    background-origin: border-box;
    border: calc(0.08 * 1rem) solid transparent;
    color: #fff;
    background-image: 
      linear-gradient(#121213, #121213),
      linear-gradient(#121213 50%, rgba(18,18,19,0.6) 80%, rgba(18,18,19,0)),
      linear-gradient(90deg, hsl(var(--color-1)), hsl(var(--color-5)), hsl(var(--color-3)), hsl(var(--color-4)), hsl(var(--color-2)));
    animation: rainbow 2s infinite linear;
}

.github-star-btn::before {
    content: '';
    position: absolute;
    bottom: -20%;
    left: 50%;
    z-index: 0;
    height: 20%;
    width: 60%;
    transform: translateX(-50%);
    background: linear-gradient(90deg, hsl(var(--color-1)), hsl(var(--color-5)), hsl(var(--color-3)), hsl(var(--color-4)), hsl(var(--color-2)));
    background-size: 200%;
    filter: blur(calc(0.8 * 1rem));
    animation: rainbow 2s infinite linear;
}

.dark .github-star-btn {
    color: #030303;
    background-image: 
      linear-gradient(#fff, #fff),
      linear-gradient(#fff 50%, rgba(255,255,255,0.6) 80%, rgba(0,0,0,0)),
      linear-gradient(90deg, hsl(var(--color-1)), hsl(var(--color-5)), hsl(var(--color-3)), hsl(var(--color-4)), hsl(var(--color-2)));
}


nav a {
  white-space: nowrap;
}

.twin-btn-container {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-direction: row-reverse;
    width: 100%;
}

@media (min-width: 768px) {
    .twin-btn-container {
        flex-direction: row;
        justify-content: flex-end;
    }
}


@media (max-width: 640px) {
    .github-star-btn {
        font-size: 12px;
        padding: 0.4rem 0.8rem;
    }
}



</style>
<a class="flex items-center mr-6" href="../index.html">
<img alt="Logo" class="mr-2 hidden dark:block" height="24" src="../_static/ell-wide-dark.png" style="min-width: 120px; max-width: 120px;" width="120"/>
<img alt="Logo" class="mr-2 dark:hidden" height="24" src="../_static/ell-wide-light.png" style="min-width: 120px; max-width: 120px;" width="120"/></a>
<nav class="flex items-center space-x-6 text-sm font-medium">
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="../index.html">Docs</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="../reference/index.html">API Reference</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="https://jobs.ell.so" rel="noopener nofollow">AI Jobs Board</a>
</nav></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex flex-wrap items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="twin-btn-container">
<div class="github-star-btn-container md:w-auto mb-2 md:mb-0">
<a class="github-star-btn whitespace-nowrap" href="https://github.com/madcowd/ell" rel="noopener noreferrer" target="_blank">
<svg aria-hidden="true" class="w-5 h-5 mr-2 hidden sm:inline-block" fill="currentColor" viewbox="0 0 24 24">
<path clip-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" fill-rule="evenodd"></path>
</svg>
<span class="font-medium">Star on GitHub</span>
<svg class="star-icon w-4 h-4 ml-2" fill="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
<animate attributename="opacity" dur="2s" repeatcount="indefinite" values="1;0.7;1"></animate>
</path>
</svg>
<span class="ml-2 star-count" data-stars="0" style="min-width: 3ch; text-align: center;">0</span>
</a>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const starBtn = document.querySelector('.github-star-btn');
      const starCount = starBtn.querySelector('.star-count');
      
      fetch('https://api.github.com/repos/madcowd/ell')
        .then(response => response.json())
        .then(data => {
          const stars = data.stargazers_count;
          animateValue(starCount, 0, stars, 1500);
        })
        .catch(error => console.error('Error fetching GitHub stars:', error));
    });

    function animateValue(obj, start, end, duration) {
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        obj.textContent = Math.floor(progress * (end - start) + start);
        obj.setAttribute('data-stars', obj.textContent);
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    }

  </script>
<div class="searchbox-container w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.querySelector('.searchbox-container input');
      const starBtnContainer = document.querySelector('.github-star-btn-container');
  
      if (searchInput && starBtnContainer) {
        const isMobile = window.innerWidth < 768; // Adjust this breakpoint as needed
  
        if (isMobile) {
          searchInput.addEventListener('focus', function() {
            starBtnContainer.style.display = 'none';
          });
  
          searchInput.addEventListener('blur', function() {
            starBtnContainer.style.display = 'block';
          });
        }
      }
    });
  </script>
</div>
<nav class="flex items-center space-x-1 mt-2 md:mt-0">
<a href="https://discord.gg/vWntgU52Xb" rel="noopener nofollow" title="Visit Discord">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="18" viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="M524.5 69.8a1.5 1.5 0 0 0 -.8-.7A485.1 485.1 0 0 0 404.1 32a1.8 1.8 0 0 0 -1.9 .9 337.5 337.5 0 0 0 -14.9 30.6 447.8 447.8 0 0 0 -134.4 0 309.5 309.5 0 0 0 -15.1-30.6 1.9 1.9 0 0 0 -1.9-.9A483.7 483.7 0 0 0 116.1 69.1a1.7 1.7 0 0 0 -.8 .7C39.1 183.7 18.2 294.7 28.4 404.4a2 2 0 0 0 .8 1.4A487.7 487.7 0 0 0 176 479.9a1.9 1.9 0 0 0 2.1-.7A348.2 348.2 0 0 0 208.1 430.4a1.9 1.9 0 0 0 -1-2.6 321.2 321.2 0 0 1 -45.9-21.9 1.9 1.9 0 0 1 -.2-3.1c3.1-2.3 6.2-4.7 9.1-7.1a1.8 1.8 0 0 1 1.9-.3c96.2 43.9 200.4 43.9 295.5 0a1.8 1.8 0 0 1 1.9 .2c2.9 2.4 6 4.9 9.1 7.2a1.9 1.9 0 0 1 -.2 3.1 301.4 301.4 0 0 1 -45.9 21.8 1.9 1.9 0 0 0 -1 2.6 391.1 391.1 0 0 0 30 48.8 1.9 1.9 0 0 0 2.1 .7A486 486 0 0 0 610.7 405.7a1.9 1.9 0 0 0 .8-1.4C623.7 277.6 590.9 167.5 524.5 69.8zM222.5 337.6c-29 0-52.8-26.6-52.8-59.2S193.1 219.1 222.5 219.1c29.7 0 53.3 26.8 52.8 59.2C275.3 311 251.9 337.6 222.5 337.6zm195.4 0c-29 0-52.8-26.6-52.8-59.2S388.4 219.1 417.9 219.1c29.7 0 53.3 26.8 52.8 59.2C470.7 311 447.5 337.6 417.9 337.6z"></path></svg>
</div>
</a>
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html">
<img alt="Logo" class="mr-2 hidden dark:block" height="16" src="../_static/ell-wide-dark.png" width="16"/>
<img alt="Logo" class="mr-2 dark:hidden" height="16" src="../_static/ell-wide-light.png" width="16"/><span class="font-bold text-clip whitespace-nowrap">ell  documentation</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="flex md:hidden flex-col font-medium mt-4">
<a href="../index.html">Docs</a>
<a href="../reference/index.html">API Reference</a>
<a href="https://jobs.ell.so" rel="nofollow noopener">AI Jobs Board</a>
</nav><nav class="table w-full min-w-full my-6 lg:my-8">
<p class="caption" role="heading"><span class="caption-text">The Basics:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ell_simple.html">@ell.simple</a></li>
<li class="toctree-l1"><a class="reference internal" href="versioning_and_storage.html">Versioning &amp; Tracing</a></li>
<li class="toctree-l1"><a class="reference internal" href="ell_studio.html">Studio</a></li>
<li class="toctree-l1"><a class="reference internal" href="message_api.html">Messages</a></li>
<li class="toctree-l1"><a class="reference internal" href="ell_complex.html">@ell.complex</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tool Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="structured_outputs.html">Structured Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="multimodality.html">Multimodality</a></li>
<li class="toctree-l1"><a class="reference internal" href="models_and_api_clients.html">Models &amp; API Clients</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">ell package</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">ell  documentation</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Tool Usage</span>
</nav>
<div id="content" role="main">
<section id="tool-usage">
<h1>Tool Usage<a class="headerlink" href="#tool-usage" title="Link to this heading">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Tool usage in ell is currently a beta feature and is highly underdeveloped. The API is likely to change significantly in future versions. Use with caution in production environments.</p>
</div>
<p>Tool usage is a powerful feature in ell that allows language models to interact with external functions and services. This capability enables the creation of more dynamic and interactive language model programs (LMPs) that can perform actions, retrieve information, and make decisions based on real-time data.</p>
<section id="defining-tools">
<h2>Defining Tools<a class="headerlink" href="#defining-tools" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#defining-tools'">¶</a></h2>
<p>In ell, tools are defined using the <code class="docutils literal notranslate"><span class="pre">@ell.tool()</span></code> decorator. This decorator transforms a regular Python function into a tool that can be used by language models. Here’s an example of a simple tool definition:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">create_claim_draft</span><span class="p">(</span><span class="n">claim_details</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-3">                       <span class="n">claim_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-4">                       <span class="n">claim_amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="line-5">                       <span class="n">claim_date</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"The date of the claim in the format YYYY-MM-DD."</span><span class="p">)):</span>
</span><span id="line-6"><span class="w">    </span><span class="sd">"""Create a claim draft. Returns the claim id created."""</span> <span class="c1"># Tool description</span>
</span><span id="line-7">    <span class="nb">print</span><span class="p">(</span><span class="s2">"Create claim draft"</span><span class="p">,</span> <span class="n">claim_details</span><span class="p">,</span> <span class="n">claim_type</span><span class="p">,</span> <span class="n">claim_amount</span><span class="p">,</span> <span class="n">claim_date</span><span class="p">)</span>
</span><span id="line-8">    <span class="k">return</span> <span class="s2">"claim_id-123234"</span>
</span></code></pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">@ell.tool()</span></code> decorator automatically generates a schema for the tool based on the function’s signature, type annotations, and docstring. This schema is used to provide structured information about the tool to the language model.</p>
</section>
<section id="schema-generation">
<h2>Schema Generation<a class="headerlink" href="#schema-generation" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#schema-generation'">¶</a></h2>
<p>ell uses a combination of function inspection and Pydantic models to generate the tool schema. The process involves:</p>
<ul class="simple">
<li><p>Extracting parameter information from the function signature.</p></li>
<li><p>Using type annotations to determine parameter types.</p></li>
<li><p>Utilizing Pydantic’s <code class="docutils literal notranslate"><span class="pre">Field</span></code> for additional parameter metadata.</p></li>
<li><p>Creating a Pydantic model to represent the tool’s parameters.</p></li>
</ul>
<p>This generated schema is then converted into a format compatible with the OpenAI API. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="p">{</span>
</span><span id="line-2">    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"function"</span><span class="p">,</span>
</span><span id="line-3">    <span class="s2">"function"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="line-4">        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"create_claim_draft"</span><span class="p">,</span>
</span><span id="line-5">        <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Create a claim draft. Returns the claim id created."</span><span class="p">,</span>
</span><span id="line-6">        <span class="s2">"parameters"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="line-7">            <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
</span><span id="line-8">            <span class="s2">"properties"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="line-9">                <span class="s2">"claim_details"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">},</span>
</span><span id="line-10">                <span class="s2">"claim_type"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">},</span>
</span><span id="line-11">                <span class="s2">"claim_amount"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">},</span>
</span><span id="line-12">                <span class="s2">"claim_date"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="line-13">                    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
</span><span id="line-14">                    <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"The date of the claim in the format YYYY-MM-DD."</span>
</span><span id="line-15">                <span class="p">}</span>
</span><span id="line-16">            <span class="p">},</span>
</span><span id="line-17">            <span class="s2">"required"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"claim_details"</span><span class="p">,</span> <span class="s2">"claim_type"</span><span class="p">,</span> <span class="s2">"claim_amount"</span><span class="p">,</span> <span class="s2">"claim_date"</span><span class="p">]</span>
</span><span id="line-18">        <span class="p">}</span>
</span><span id="line-19">    <span class="p">}</span>
</span><span id="line-20"><span class="p">}</span>
</span></code></pre></div>
</div>
</section>
<section id="using-tools-in-lmps">
<h2>Using Tools in LMPs<a class="headerlink" href="#using-tools-in-lmps" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#using-tools-in-lmps'">¶</a></h2>
<p>To use tools in a language model program, you need to specify them in the <code class="docutils literal notranslate"><span class="pre">@ell.complex</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-4o"</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">create_claim_draft</span><span class="p">],</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">insurance_claim_chatbot</span><span class="p">(</span><span class="n">message_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
</span><span id="line-3">    <span class="k">return</span> <span class="p">[</span>
</span><span id="line-4">        <span class="n">ell</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"""You are an insurance adjuster AI. You are given a dialogue with a user and have access to various tools to effectuate the insurance claim adjustment process. Ask questions until you have enough information to create a claim draft. Then ask for approval."""</span><span class="p">),</span>
</span><span id="line-5">    <span class="p">]</span> <span class="o">+</span> <span class="n">message_history</span>
</span></code></pre></div>
</div>
<p>This allows the language model to access and use the specified tools within the context of the LMP.</p>
</section>
<section id="single-step-tool-usage">
<h2>Single-Step Tool Usage<a class="headerlink" href="#single-step-tool-usage" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#single-step-tool-usage'">¶</a></h2>
<p>In single-step tool usage, the language model decides to use a tool once during its execution. The process typically involves the LMP receiving input, generating a response with a tool call.</p>
<p>Here’s an example where we want to take a natural language string for a website and convert it into a URL to get its content. We’ll call this LMP <code class="docutils literal notranslate"><span class="pre">get_website_content</span></code>, and it will allow the user to get the HTML page of any website they ask for in natural language. The chief goal of the language model here is to convert the website description into a URL and then invoke the <code class="docutils literal notranslate"><span class="pre">get_html_content</span></code> tool. The language model also has the option to refuse the request if no such website exists within its knowledge base.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">get_html_content</span><span class="p">(</span>
</span><span id="line-3">    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">"The URL to get the HTML content of. Never include the protocol (like http:// or https://)"</span><span class="p">),</span>
</span><span id="line-4"><span class="p">):</span>
</span><span id="line-5"><span class="w">    </span><span class="sd">"""Get the HTML content of a URL."""</span>
</span><span id="line-6">    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"https://"</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
</span><span id="line-7">    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">'html.parser'</span><span class="p">)</span>
</span><span id="line-8">    <span class="k">return</span> <span class="n">soup</span><span class="o">.</span><span class="n">get_text</span><span class="p">()[:</span><span class="mi">100</span><span class="p">]</span>
</span><span id="line-9">
</span><span id="line-10"><span class="nd">@ell</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-4o"</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">get_html_content</span><span class="p">])</span>
</span><span id="line-11"><span class="k">def</span> <span class="nf">get_website_content</span><span class="p">(</span><span class="n">website</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-12"><span class="w">    </span><span class="sd">"""You are an agent that can summarize the contents of a website."""</span>
</span><span id="line-13">    <span class="k">return</span> <span class="sa">f</span><span class="s2">"Tell me what's on </span><span class="si">{</span><span class="n">website</span><span class="si">}</span><span class="s2">"</span>
</span></code></pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">get_website_content</span><span class="p">(</span><span class="s2">"new york times front page"</span><span class="p">)</span>
</span><span id="line-2"><span class="go">Message(role='assistant', content=[ContenBlock(tool_call=ToolCall(id='tool_call_id', function=Function(name='get_html_content', arguments='{"url": "nyt.com"}'))])</span>
</span><span id="line-3">
</span><span id="line-4"><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">[</span><span class="mi">0</span><span class="p">]())</span>
</span><span id="line-5"><span class="go">'''&lt;html lang="en" class="nytapp-vi-homepage nytapp-vi-homepage " xmlns:og="http://opengraphprotocol.org/schema/" data-rh="lang,class"&gt;&lt;head&gt;</span>
</span><span id="line-6"><span class="go">&lt;meta charset="utf-8"&gt;</span>
</span><span id="line-7"><span class="go">&lt;title&gt;The New York Times - Breaking News, US News, World News and Videos&lt;/title&gt;</span>
</span><span id="line-8"><span class="go">&lt;meta'''</span>
</span></code></pre></div>
</div>
<p>We could also handle text based message Responses from the language model where it. may decline to call the tool. the tool or ask for clarification By looking into output text only. In this case, because the language model decided to call the tool, this should be empty.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">text_only</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">text_only</span><span class="p">)</span>
</span><span id="line-2"><span class="go">None</span>
</span></code></pre></div>
</div>
</section>
<section id="multi-step-tool-usage">
<h2>Multi-Step Tool Usage<a class="headerlink" href="#multi-step-tool-usage" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#multi-step-tool-usage'">¶</a></h2>
<p>Multi-step tool usage involves a more complex interaction where the language model may use tools multiple times in a conversation or processing flow. This is particularly useful for chatbots or interactive systems.</p>
<p>In a typical LLM API the flow for multi-step tool usage looks like this</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="mf">1.</span> <span class="n">You</span> <span class="n">call</span> <span class="n">the</span> <span class="n">LLM</span> <span class="k">with</span> <span class="n">a</span> <span class="n">message</span>
</span><span id="line-2"><span class="mf">2.</span> <span class="n">The</span> <span class="n">LLM</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">message</span> <span class="k">with</span> <span class="n">tool</span> <span class="n">Call</span>
</span><span id="line-3"><span class="mf">3.</span> <span class="n">You</span> <span class="n">call</span> <span class="n">the</span> <span class="n">tools</span> <span class="n">on</span> <span class="n">your</span> <span class="n">end</span> <span class="ow">and</span> <span class="nb">format</span> <span class="n">the</span> <span class="n">results</span> <span class="n">back</span> <span class="n">into</span> <span class="n">a</span> <span class="n">message</span>
</span><span id="line-4"><span class="mf">4.</span> <span class="n">You</span> <span class="n">call</span> <span class="n">the</span> <span class="n">LLM</span> <span class="k">with</span> <span class="n">the</span> <span class="n">tool</span> <span class="n">result</span> <span class="n">message</span>
</span><span id="line-5"><span class="mf">5.</span> <span class="n">The</span> <span class="n">LLM</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">message</span> <span class="k">with</span> <span class="n">it</span><span class="s1">'s final response</span>
</span></code></pre></div>
</div>
<p>This process can be error-prone and requires a lot of boilerplate code.
To simplify this process, ell provides a helper function <code class="docutils literal notranslate"><span class="pre">call_tools_and_collect_as_message()</span></code>. This function executes all tool calls in a response and collects the results into a single message, which can then be easily added to the conversation history.</p>
<p>Here’s an example of a multi-step interaction using the insurance claim chatbot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-4o"</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">create_claim_draft</span><span class="p">],</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">insurance_claim_chatbot</span><span class="p">(</span><span class="n">message_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
</span><span id="line-3">    <span class="k">return</span> <span class="p">[</span>
</span><span id="line-4">        <span class="n">ell</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">"""You are an insurance adjuster AI. You are given a dialogue with a user and have access to various tools to effectuate the insurance claim adjustment process. Ask questions until you have enough information to create a claim draft. Then ask for approval."""</span><span class="p">),</span>
</span><span id="line-5">    <span class="p">]</span> <span class="o">+</span> <span class="n">message_history</span>
</span><span id="line-6">
</span><span id="line-7"><span class="n">message_history</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-8"><span class="n">user_messages</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="line-9">    <span class="s2">"Hello, I'm a customer"</span><span class="p">,</span>
</span><span id="line-10">    <span class="s1">'I broke my car'</span><span class="p">,</span>
</span><span id="line-11">    <span class="s1">' smashed by someone else, today, $5k'</span><span class="p">,</span>
</span><span id="line-12">    <span class="s1">'please file it.'</span>
</span><span id="line-13"><span class="p">]</span>
</span><span id="line-14"><span class="k">for</span> <span class="n">user_message</span> <span class="ow">in</span> <span class="n">user_messages</span><span class="p">:</span>
</span><span id="line-15">    <span class="n">message_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ell</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">user_message</span><span class="p">))</span>
</span><span id="line-16">    <span class="n">response_message</span> <span class="o">=</span> <span class="n">insurance_claim_chatbot</span><span class="p">(</span><span class="n">message_history</span><span class="p">)</span>
</span><span id="line-17">    <span class="n">message_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_message</span><span class="p">)</span>
</span><span id="line-18">
</span><span id="line-19">    <span class="k">if</span> <span class="n">response_message</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
</span><span id="line-20">        <span class="n">next_message</span> <span class="o">=</span> <span class="n">response_message</span><span class="o">.</span><span class="n">call_tools_and_collect_as_message</span><span class="p">()</span>
</span><span id="line-21">        <span class="n">message_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_message</span><span class="p">)</span>
</span><span id="line-22">        <span class="n">insurance_claim_chatbot</span><span class="p">(</span><span class="n">message_history</span><span class="p">)</span>
</span></code></pre></div>
</div>
<section id="parallel-tool-execution">
<h3>Parallel Tool Execution<a class="headerlink" href="#parallel-tool-execution" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#parallel-tool-execution'">¶</a></h3>
<p>For efficiency, ell supports parallel execution of multiple tool calls:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">:</span>
</span><span id="line-2">    <span class="n">tool_results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">call_tools_and_collect_as_message</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span></code></pre></div>
</div>
<p>This can significantly speed up operations when multiple independent tool calls are made.</p>
</section>
</section>
<section id="future-features-eager-mode">
<h2>Future Features: Eager Mode<a class="headerlink" href="#future-features-eager-mode" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#future-features-eager-mode'">¶</a></h2>
<p>In the future, ell may introduce an “eager mode” for tool usage. This feature would automatically execute tool calls made by the language model, creating a multi-step interaction behind the scenes. This could streamline the development process by reducing the need for explicit tool call handling in the code.</p>
<p>Eager mode could potentially work like this:</p>
<ul class="simple">
<li><p>The LMP generates a response with a tool call.</p></li>
<li><p>ell automatically executes the tool and captures its result.</p></li>
<li><p>The result is immediately fed back into the LMP for further processing.</p></li>
<li><p>This cycle continues until the LMP generates a final response without tool calls.</p></li>
</ul>
<p>This feature would make it easier to create complex, multi-step interactions without the need for explicit loop handling in the user code. It would be particularly useful for scenarios where the number of tool calls is not known in advance, such as in open-ended conversations or complex problem-solving tasks.</p>
</section>
<section id="future-features-tool-spec-autogeneration">
<h2>Future Features: Tool Spec Autogeneration<a class="headerlink" href="#future-features-tool-spec-autogeneration" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#future-features-tool-spec-autogeneration'">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Thanks to <a class="reference external" href="https://x.com/aidan_mclau">Aidan McLau</a> for suggesting this feature.</p>
</div>
<p>In an ideal world, a prompt engineering library would not require the user to meticulously specify the schema for a tool. Instead, a language model should be able to infer the tool specification directly from the source code of the tool. In ell, we can extract the lexically closed source of any Python function, enabling a feature where the schema is automatically generated by another language model when a tool is given to an ell decorator.</p>
<p>This approach eliminates the need for users to manually type every argument and provide a tool description, as the description becomes implicit from the source code.</p>
<p>Consider the following example function in a user’s code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">def</span> <span class="nf">search_twitter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="line-2"> <span class="c1"># Query must be three words or less</span>
</span><span id="line-3"> <span class="k">async</span> <span class="k">def</span> <span class="nf">fetch_tweets</span><span class="p">():</span>
</span><span id="line-4">     <span class="n">api</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>
</span><span id="line-5">     <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">login_all</span><span class="p">()</span>
</span><span id="line-6">     <span class="k">try</span><span class="p">:</span>
</span><span id="line-7">         <span class="n">tweets</span> <span class="o">=</span> <span class="p">[</span><span class="n">tweet</span> <span class="k">async</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">api</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">n</span><span class="p">)]</span>
</span><span id="line-8">
</span><span id="line-9">         <span class="n">tweet_strings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="line-10">             <span class="sa">f</span><span class="s2">"Search Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-11">             <span class="sa">f</span><span class="s2">"Author: </span><span class="si">{</span><span class="n">tweet</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-12">             <span class="sa">f</span><span class="s2">"Tweet: </span><span class="si">{</span><span class="n">tweet</span><span class="o">.</span><span class="n">rawContent</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-13">             <span class="sa">f</span><span class="s2">"Created at: </span><span class="si">{</span><span class="n">tweet</span><span class="o">.</span><span class="n">date</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-14">             <span class="sa">f</span><span class="s2">"Favorites: </span><span class="si">{</span><span class="n">tweet</span><span class="o">.</span><span class="n">likeCount</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-15">             <span class="sa">f</span><span class="s2">"Retweets: </span><span class="si">{</span><span class="n">tweet</span><span class="o">.</span><span class="n">retweetCount</span><span class="si">}</span><span class="se">\n\n\n</span><span class="s2">"</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">tweets</span>
</span><span id="line-16">         <span class="p">]</span>
</span><span id="line-17">         <span class="k">if</span> <span class="n">tweet_strings</span><span class="p">:</span>
</span><span id="line-18">             <span class="nb">print</span><span class="p">(</span><span class="n">tweet_strings</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Print the first tweet</span>
</span><span id="line-19">         <span class="k">return</span> <span class="n">tweet_strings</span>
</span><span id="line-20">     <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="line-21">         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error fetching search tweets: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-22">         <span class="k">return</span> <span class="p">[]</span>
</span><span id="line-23">
</span><span id="line-24"> <span class="n">tweets</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fetch_tweets</span><span class="p">())</span>
</span><span id="line-25"> <span class="n">tweets</span> <span class="o">=</span> <span class="n">tweets</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span>
</span><span id="line-26"> <span class="n">tweets</span> <span class="o">=</span> <span class="s2">"&lt;twitter_results&gt;"</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tweets</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"&lt;/twitter_results&gt;"</span>
</span><span id="line-27"> <span class="k">return</span> <span class="n">tweets</span>
</span></code></pre></div>
</div>
<p>With tool spec autogeneration, the user could wrap this search_twitter function with a tool decorator and an optional parameter to automatically generate the tool spec. The following specification would be generated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span><span class="n">autogenerate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">search_twitter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="line-3">    <span class="o">...</span>
</span></code></pre></div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="p">{</span>
</span><span id="line-2"><span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"function"</span><span class="p">,</span>
</span><span id="line-3"><span class="w">  </span><span class="nt">"function"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-4"><span class="w">    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"search_twitter"</span><span class="p">,</span>
</span><span id="line-5"><mark><span class="w">    </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Search Twitter for tweets"</span><span class="p">,</span>
</mark></span><span id="line-6"><span class="w">    </span><span class="nt">"parameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-7"><span class="w">      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="line-8"><span class="w">      </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-9"><span class="w">        </span><span class="nt">"query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-10"><span class="w">          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="line-11"><mark><span class="w">          </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The query to search for, this must be three words or less"</span>
</mark></span><span id="line-12"><span class="w">        </span><span class="p">},</span>
</span><span id="line-13"><span class="w">        </span><span class="nt">"n"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-14"><span class="w">          </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"integer"</span><span class="p">,</span>
</span><span id="line-15"><span class="w">          </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The number of tweets to return"</span>
</span><span id="line-16"><span class="w">        </span><span class="p">}</span>
</span><span id="line-17"><span class="w">      </span><span class="p">},</span>
</span><span id="line-18"><span class="w">      </span><span class="nt">"required"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"query"</span><span class="p">]</span>
</span><span id="line-19"><span class="w">    </span><span class="p">}</span>
</span><span id="line-20"><span class="w">  </span><span class="p">}</span>
</span><span id="line-21"><span class="p">}</span>
</span></code></pre></div>
</div>
<p>This is accomplished by a language model program that takes the source code of a tool function as input and generates the corresponding tool specification.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">simple</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"claude-3-5-sonnet-20241022"</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">generate_tool_spec</span><span class="p">(</span><span class="n">tool_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-3"><span class="w">    </span><span class="sd">'''</span>
</span><span id="line-4"><span class="sd">    You are a helpful assistant that takes in source code for a python function and produces a JSON schema for the function.</span>
</span><span id="line-5">
</span><span id="line-6"><span class="sd">    Here is an example schema</span>
</span><span id="line-7"><span class="sd">    {</span>
</span><span id="line-8"><span class="sd">        "type": "function",</span>
</span><span id="line-9"><span class="sd">        "function": {</span>
</span><span id="line-10"><span class="sd">            "name": "some_tool",</span>
</span><span id="line-11"><span class="sd">            "parameters": {</span>
</span><span id="line-12"><span class="sd">                "type": "object",</span>
</span><span id="line-13"><span class="sd">                "properties": {</span>
</span><span id="line-14"><span class="sd">                    "some_arg": {</span>
</span><span id="line-15"><span class="sd">                        "type": "string",</span>
</span><span id="line-16"><span class="sd">                        "description": "This is a description of the argument"</span>
</span><span id="line-17"><span class="sd">                    }</span>
</span><span id="line-18"><span class="sd">                },</span>
</span><span id="line-19"><span class="sd">                "required": ["some_arg"]</span>
</span><span id="line-20"><span class="sd">            }</span>
</span><span id="line-21"><span class="sd">        }</span>
</span><span id="line-22"><span class="sd">    }</span>
</span><span id="line-23"><span class="sd">    '''</span>
</span><span id="line-24">
</span><span id="line-25">    <span class="k">return</span> <span class="sa">f</span><span class="s2">"Generate a tool spec for the following function: </span><span class="si">{</span><span class="n">tool_source</span><span class="si">}</span><span class="s2">"</span>
</span><span id="line-26">
</span><span id="line-27"><span class="c1"># ...</span>
</span><span id="line-28"><span class="c1"># When autogenerate is called.</span>
</span><span id="line-29"><span class="n">auto_tool_spec</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">generate_tool_spec</span><span class="p">(</span><span class="n">search_twitter</span><span class="p">))</span>
</span></code></pre></div>
</div>
<p>For this approach to be effective, the generate tool spec calls should only be executed when the version of the tool source code changes. Refer to the versioning and tracing section for details on how this is computed. Additionally, the generated tool spec would need to be stored in a consistent and reusable ell store.</p>
<p>This approach does present some potential challenges:</p>
<ol class="arabic simple">
<li><p>It introduces opinions into ell as a library by including a specific prompt for automatically generating tool specs.</p></li>
<li><p>It may compromise consistency regarding the reproducibility of prompts.</p></li>
</ol>
<p>To address the issue of opinionation, we could require users to implement their own prompt for automatically generating tool specs from source code. While ell could offer some pre-packaged options, it would require users to make a conscious decision to use this auto-generation function, as it has more significant consequences than, for example, auto-committing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="nd">@ell</span><span class="o">.</span><span class="n">simple</span>
</span><span id="line-2"><span class="k">def</span> <span class="nf">my_custom_tool_spec_generator</span><span class="p">(</span><span class="n">tool_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="line-3">    <span class="c1"># User implements this once in their code base or repo</span>
</span><span id="line-4">    <span class="o">...</span>
</span><span id="line-5">
</span><span id="line-6"><span class="nd">@ell</span><span class="o">.</span><span class="n">tool</span><span class="p">(</span><span class="n">autogenerate</span><span class="o">=</span><span class="n">my_custom_tool_spec_generator</span><span class="p">)</span>
</span><span id="line-7"><span class="k">def</span> <span class="nf">search_twitter</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
</span><span id="line-8">    <span class="o">...</span>
</span><span id="line-9">
</span><span id="line-10"><span class="nd">@ell</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">"gpt-4o"</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">search_twitter</span><span class="p">])</span>
</span><span id="line-11"><span class="k">def</span> <span class="nf">my_llm_program</span><span class="p">(</span><span class="n">message_history</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
</span><span id="line-12">    <span class="o">...</span>
</span></code></pre></div>
</div>
<p>The reproducibility aspect can be mitigated by serializing the generated tool specification along with its version in the ell store. This ensures that all invocations depend on the specific generated tool specification, maintaining consistency across different runs.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">lexical_closure</span><span class="p">(</span><span class="n">search_twitter</span><span class="p">)</span>
</span><span id="line-2"><span class="go">"""</span>
</span><span id="line-3"><span class="go">@ell.simple</span>
</span><span id="line-4"><span class="go">def my_custom_tool_spec_generator(tool_source: str):</span>
</span><span id="line-5"><span class="go">    # User implements this</span>
</span><span id="line-6"><span class="go">    ...</span>
</span><span id="line-7">
</span><span id="line-8"><span class="go">_generated_spec = my_custom_tool_spec_generator(lexical_closure(search_twitter))</span>
</span><span id="line-9"><span class="go">'''</span>
</span><span id="line-10"><span class="go">  {</span>
</span><span id="line-11"><span class="go">  "type": "function",</span>
</span><span id="line-12"><span class="go">  "function": {</span>
</span><span id="line-13"><span class="go">    "name": "search_twitter",</span>
</span><span id="line-14"><span class="go">    "description": "Search Twitter for tweets",</span>
</span><span id="line-15"><span class="go">    "parameters": {</span>
</span><span id="line-16"><span class="go">      "type": "object",</span>
</span><span id="line-17"><span class="go">      "properties": {</span>
</span><span id="line-18"><span class="go">        "query": {</span>
</span><span id="line-19"><span class="go">          "type": "string",</span>
</span><span id="line-20"><span class="go">          "description": "The query to search for, this must be three words or less"</span>
</span><span id="line-21"><span class="go">        },</span>
</span><span id="line-22"><span class="go">        "n": {</span>
</span><span id="line-23"><span class="go">          "type": "integer",</span>
</span><span id="line-24"><span class="go">          "description": "The number of tweets to return"</span>
</span><span id="line-25"><span class="go">        }</span>
</span><span id="line-26"><span class="go">      },</span>
</span><span id="line-27"><span class="go">      "required": ["query"]</span>
</span><span id="line-28"><span class="go">    }</span>
</span><span id="line-29"><span class="go">  }</span>
</span><span id="line-30"><span class="go">}</span>
</span><span id="line-31"><span class="go">'''</span>
</span><span id="line-32">
</span><span id="line-33"><span class="go">@ell.tool(toolspec=_generated_spec)</span>
</span><span id="line-34"><span class="go">def search_twitter(query, n=7):</span>
</span><span id="line-35"><span class="go">    ...</span>
</span></code></pre></div>
</div>
<p>Furthermore, consistency can be enforced by requiring specification generators to use a temperature of 0.0 and be near-deterministic in their output. This approach ensures that the generated tool specifications remain consistent across different runs, enhancing reproducibility and reliability in the tool generation process.</p>
</section>
</section>
</div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
<div class="mr-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="ell_complex.html">
<svg class="mr-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
        @ell.complex
      </a>
</div>
<div class="ml-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="structured_outputs.html">
        Structured Outputs
        <svg class="ml-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</a>
</div>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#defining-tools'" class="reference internal" href="#defining-tools">Defining Tools</a></li>
<li><a :data-current="activeSection === '#schema-generation'" class="reference internal" href="#schema-generation">Schema Generation</a></li>
<li><a :data-current="activeSection === '#using-tools-in-lmps'" class="reference internal" href="#using-tools-in-lmps">Using Tools in LMPs</a></li>
<li><a :data-current="activeSection === '#single-step-tool-usage'" class="reference internal" href="#single-step-tool-usage">Single-Step Tool Usage</a></li>
<li><a :data-current="activeSection === '#multi-step-tool-usage'" class="reference internal" href="#multi-step-tool-usage">Multi-Step Tool Usage</a><ul>
<li><a :data-current="activeSection === '#parallel-tool-execution'" class="reference internal" href="#parallel-tool-execution">Parallel Tool Execution</a></li>
</ul>
</li>
<li><a :data-current="activeSection === '#future-features-eager-mode'" class="reference internal" href="#future-features-eager-mode">Future Features: Eager Mode</a></li>
<li><a :data-current="activeSection === '#future-features-tool-spec-autogeneration'" class="reference internal" href="#future-features-tool-spec-autogeneration">Future Features: Tool Spec Autogeneration</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2024, William Guss Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 7.2.6</a></p>
</div>
</div>
</footer>
</div>
<script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=888ff710"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="../_static/theme.js?v=e82a16a3"></script>
</body>
</html>