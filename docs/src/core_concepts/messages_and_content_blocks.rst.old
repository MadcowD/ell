Messages and Content Blocks in ell2a
==================================

In ell2a, the Message and ContentBlock classes are fundamental to handling communication with language models, especially in multi-turn conversations and when dealing with various types of content. This guide will help you understand how to work with these important components.

Messages
--------

A Message in ell2a represents a single interaction in a conversation with a language model. It has two main components:

1. A role (e.g., "system", "user", "assistant")
2. Content (represented by a list of ContentBlocks)

Creating Messages
^^^^^^^^^^^^^^^^^

ell2a provides helper functions to create messages with specific roles:

.. code-block:: python

    import ell2a

    system_message = ell2a.system("You are a helpful AI assistant.")
    user_message = ell2a.user("What's the weather like today?")
    assistant_message = ell2a.assistant("I'm sorry, I don't have access to real-time weather information.")

You can also create messages directly:

.. code-block:: python

    from ell2a import Message, ContentBlock

    message = Message(role="user", content=[ContentBlock(text="Hello, world!")])

Content Blocks
--------------

ContentBlocks are used to represent different types of content within a message. They can contain:

- Text
- Images
- Audio (future support)
- Agent calls
- Agent results
- Structured data (parsed content)

Creating Content Blocks
^^^^^^^^^^^^^^^^^^^^^^^

Here are examples of creating different types of ContentBlocks:

.. code-block:: python

    from ell2a import ContentBlock
    from PIL import Image

    # Text content block
    text_block = ContentBlock(text="This is a text message.")

    # Image content block
    image = Image.open("example.jpg")
    image_block = ContentBlock(image=image)

    # Agent call content block
    agent_call_block = ContentBlock(agent_call=some_agent_call)

    # Parsed content block (structured data)
    from pydantic import BaseModel

    class UserInfo(BaseModel):
        name: str
        age: int

    user_info = UserInfo(name="Alice", age=30)
    parsed_block = ContentBlock(parsed=user_info)

Working with Content Blocks in Messages
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

You can combine multiple ContentBlocks in a single Message:

.. code-block:: python

    multi_content_message = ell2a.user([
        ContentBlock(text="Here's an image of a cat:"),
        ContentBlock(image=cat_image)
    ])

Using Messages and Content Blocks in LMPs
-----------------------------------------

In complex LMPs, you'll often work with lists of Messages:

.. code-block:: python

    @ell2a.complex(model="gpt-4")
    def chat_bot(message_history: List[ell2a.Message]) -> List[ell2a.Message]:
        return [
            ell2a.system("You are a friendly chat bot."),
            *message_history,
            ell2a.assistant("How can I help you today?")
        ]

Accessing Message Content
-------------------------

You can access the content of a Message in different ways:

.. code-block:: python

    # Get all text content
    text_content = message.text

    # Get only the text content, excluding non-text elements
    text_only = message.text_only

    # Access specific content types
    agent_calls = message.agent_calls
    agent_results = message.agent_results
    structured = message.structured

Best Practices
--------------

1. Use the appropriate ContentBlock type for each piece of content.
2. When working with complex LMPs, always return a list of Messages.
3. Use the helper functions (ell2a.system, ell2a.user, ell2a.assistant) for clarity.
4. When dealing with multimodal content, combine different ContentBlock types in a single Message.

By mastering Messages and ContentBlocks, you'll be able to create sophisticated interactions with language models, handle various types of data, and build complex conversational flows in your ell2a applications.